# Last Change: Mon Oct 29 06:00 PM 2007 J
# vim:syntax=python
from numpy.distutils.misc_util import get_numpy_include_dirs, get_mathlibs
from numpy.distutils.scons import GetNumpyEnvironment, scons_get_paths
from numpy.distutils.scons import CheckLAPACK
from numpy.distutils.scons.configuration import write_info

env = GetNumpyEnvironment(ARGUMENTS)
env.Append(CPPPATH = scons_get_paths(env['include_bootstrap']))

config = env.NumpyConfigure(custom_tests = 
    {'CheckLAPACK' : CheckLAPACK})

use_lapack = config.CheckLAPACK()

# XXX: this is ugly, better find the mathlibs with a checker 
for i in scons_get_paths(env['include_bootstrap']):
    try:
        mlib =  get_mathlibs(i)
        break
    except IOError:
        pass
env.AppendUnique(LIBS = mlib)

config.Finish()
write_info(env)

sources = ['lapack_litemodule.c']
if not use_lapack:
    sources.extend(['zlapack_lite.c', 'dlapack_lite.c', 'blas_lite.c',
                    'dlamch.c', 'f2c_lite.c'])
lapack_lite = env.NumpyPythonExtension('lapack_lite', source = sources)
            
